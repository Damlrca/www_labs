<!DOCTYPE html>
<html>
	<head>
		<title>Lab2_fi3_Sadikov</title>
		<meta name="author" compact="Sadikov Damir">
		<meta charset="UTF-8">
		
		<style>
			.class1 { height:30px; width:30px; background-color:lightBlue; }
			.class2 { height:30px; width:30px; background-color:red; }
			
		</style>
		
	</head>
	<body onload>
		<h1>Война Вирусов!</h1>
		
		<table border="1">
			<tbody id="myTable">
			</tbody>
		</table>
		
		<script type="application/javascript" defer>
			function create_table() {
				let myTable = document.getElementById("myTable");
				console.log(myTable);
				for (let i = 0; i < 10; i++) {
					let newLine = document.createElement("tr");
					for (let j = 0; j < 10; j++) {
						let newElem = document.createElement("td");
						newElem.id = "e_" + i + "_" + j;
						newElem.align = "center";
						newElem.classList.add("class1");
						newElem.AAAAX = i;
						newElem.AAAAY = j;
						if ((i + j) % 2 == 0) {
							newElem.classList.add("class1");
						}
						else {
							newElem.classList.add("class2");
						}
						newElem.onclick = function() {
							//myfunction(this.id);
							myfunction({X:this.AAAAX, Y:this.AAAAY});
							//myfunction(JSON.stringify({X:this.AAAAX, Y:this.AAAAY}));
						};
						newElem.appendChild(document.createTextNode("X"));
						newLine.appendChild(newElem);
					}
					myTable.appendChild(newLine);
				}
			}
			
			create_table();
			
			let socket = new WebSocket("ws://localhost:8181/ws");
			socket.onopen = function() {
				console.log("Соединение установлено.");
			};
			socket.onclose = function(event) {
				if (event.wasClean) {
					console.log("Соединение закрыто чисто");
				}
				else {
					console.log("Обрыв соединения");
				}
				console.log("Код: " + event.code + " причина: " + event.reason);
			};
			socket.onmessage = function(event) {
				console.log("Полученные данные: " + event.data);
				let message_JSON = JSON.parse(event.data);
				console.log("x=" + message_JSON.X + " y=" + message_JSON.Y);
				// TODO получение данных
			}
			socket.onerror = function(error) {
				console.log("Ошибка: " + error.message);
			};
			
			function myfunction(elem) {
				// TODO отправка данных
				//alert(elem);
				socket.send(JSON.stringify(elem));
			}
		</script>
	</body>
</html>
